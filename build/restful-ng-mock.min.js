(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("basicMock",["$httpBackend",function(t){function e(t,e){if(this._baseUrl=t||"",!o.test(this._baseUrl))throw'Invalid baseUrl for resourceMock: "'+t+'".';this.options=angular.extend({},this.DEFAULT_OPTIONS),this.setOptions(e||{})}var o=/^(\/[\w\-]+|)(\/[\w\-]+|\/\?)*$/;e.prototype.constructor=e,e.prototype.HttpError=function(){function t(t,e){this.code=t,this.message=e}return t}(),e.prototype.DEFAULT_OPTIONS={debug:!1,httpResponseInfoLabel:!1},e.prototype._buildResponse=function(t,e,o,n,r){(angular.isUndefined(t)||null===t)&&(t=new this.HttpError(404,"Not Found"));var i={code:200,message:"OK"};t instanceof this.HttpError&&(i.code=t.code,i.message=t.message,t=this.options.httpResponseInfoLabel?{}:i),this.options.httpResponseInfoLabel&&(t[this.options.httpResponseInfoLabel]=i);var s=JSON.stringify(t);if(this.options.debug){var a=this.options.debug;"function"!=typeof a&&(a=this._defaultDebug),a(e,o,n,r,i.code,JSON.parse(s))}return[i.code,s,{"Content-Type":"application/json"}]},e.prototype._defaultDebug=function(t,e,o,n,r,i){var s=function(t,e){return Array(Math.max(e-(t+"").length+1,0)).join(0)+t},a=new Date,u=[s(a.getHours(),2),s(a.getMinutes(),2),s(a.getSeconds(),2),s(a.getMilliseconds(),3)];console.log([u.join(":"),">>> "+t+" "+e,"<<< "+r,i])},e.prototype.route=function(e,n,r){if(!o.test(n))throw'Invalid url for route: "'+n+'".';var i=this._baseUrl+n,s=i.replace(/\//g,"\\/").replace(/\?/g,"([\\w\\-]+)"),a=RegExp("^"+s+"(?:\\?.*)?$"),u=this;t.when(e,a).respond(function(t,e,o,n){var i=purl(e,!0);i.raw=e;var s=a.exec(i.attr("path")).slice(1);/^application\/json($|;)/.test(n["Content-Type"])&&(o=JSON.parse(o));var p=r.call(u,s,t,i,o,n);return u._buildResponse(p,t,e,o,n)})},e.prototype.setOptions=function(t){var e=this;return angular.forEach(t,function(t,o){if(e.DEFAULT_OPTIONS[o]===void 0)throw"Invalid option key "+o;e.options[o]=t}),e};var n=function(t,o){return new e(t,o)};return n.classFn=e,n}]),angular.module("restfulNgMock").factory("resourceMock",["basicMock",function(t){function e(t,o,n){e._super.constructor(t,n),this.dataSource=o||{},this.requiredParams=0;for(var r=0;t.length>r;++r)"?"===t.charAt(r)&&++this.requiredParams;this.route("GET","",function(t,e,o,n,r){var i=this.indexAction(t,o,n,r);return this._labelEncap(!0,i)}),this.route("GET","/?",function(t,e,o,n,r){var i=this.showAction(t,o,n,r);return this._labelEncap(!1,i)}),this.route("POST","",function(t,e,o,n,r){var i=this.createAction(t,o,n,r);return this._labelEncap(!1,i)}),this.route("PUT","/?",function(t,e,o,n,r){var i=this.updateAction(t,o,n,r);return this._labelEncap(!1,i)}),this.route("DELETE","/?",function(t,e,o,n,r){var i=this.deleteAction(t,o,n,r);return this._labelEncap(!1,i)})}(function(){function o(){this.constructor=e}var n=t.classFn;o.prototype=n.prototype,e.prototype=new o,e._super=n.prototype})(),e.prototype.parent=e.prototype,e.prototype.DEFAULT_OPTIONS=angular.extend({},e._super.DEFAULT_OPTIONS,{collectionLabel:!1,singletonLabel:!1,skipArgumentName:!1,limitArgumentName:!1}),e.prototype._labelEncap=function(t,e){if(e&&!(e instanceof this.HttpError)){var o=null;if(t&&this.options.collectionLabel?o=this.options.collectionLabel:!t&&this.options.singletonLabel&&(o=this.options.singletonLabel),o){var n=e;e={},e[o]=n}}return e},e.prototype.subResourceMock=function(t,o,n){return new e(this._baseUrl+"/?"+t,o,n)},e.prototype.getStorage=function(t,e){e=e||!1;for(var o=this.dataSource,n=0;t.length>n;++n)if(o[t[n]])o=o[t[n]];else{if(!e)return null;o[t[n]]={},o=o[t[n]]}return o||null},e.prototype.indexAction=function(t,e){var o=this.getStorage(t);if(o){var n=[];if(angular.forEach(o,function(t,e){/^\d+$/.test(e)&&(e=parseInt(e,10)),n.push(e)}),n.sort(),this.options.skipArgumentName){var r=parseInt(e.param(this.options.skipArgumentName),10);r&&(n=n.slice(r))}if(this.options.limitArgumentName){var i=parseInt(e.param(this.options.limitArgumentName),10);i&&(n=n.slice(0,i))}var s=[];return angular.forEach(n,function(t){s.push(o[t])}),s}},e.prototype.showAction=function(t){return this.getStorage(t)},e.prototype.createAction=function(t,e,o){return o.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t,!0)[o.id]=o,o},e.prototype.updateAction=function(t,e,o){var n=this.getStorage(t.slice(0,-1)),r=t.pop();return n&&n[r]?(o.id=n[r].id,n[r]=o,o):void 0},e.prototype.deleteAction=function(t){var e=this.getStorage(t.slice(0,-1)),o=t.pop();if(e&&e[o]){var n=e[o];return delete e[o],n}};var o=function(t,o){return new e(t,o)};return o.classFn=e,o}])})(window);