(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("basicMock",["$httpBackend",function(t){function e(t,e){if(this._baseUrl=t||"",!o.test(this._baseUrl))throw'Invalid baseUrl for resourceMock: "'+t+'".';this.options=angular.extend({},this.DEFAULT_OPTIONS),this.setOptions(e||{})}var o=/^(\/[\w\-]+|)(\/[\w\-]+|\/\?)*$/;e.prototype.constructor=e,e.prototype.HttpError=function(){function t(t,e){this.code=t,this.message=e}return t}(),e.prototype.HttpRequest=function(){function t(t,e,o,r,n,i){this.pathArgs=t,this.method=e,this.rawUrl=o,this.url=r,this.rawBody=n,this.body=/^application\/json($|;)/.test(i["Content-Type"])?JSON.parse(n):n,this.headers=i}return t}(),e.prototype.DEFAULT_OPTIONS={debug:!1,httpResponseInfoLabel:!1},e.prototype._buildResponse=function(t,e){(angular.isUndefined(t)||null===t)&&(t=new this.HttpError(404,"Not Found"));var o={code:200,message:"OK"};t instanceof this.HttpError&&(o.code=t.code,o.message=t.message,t=this.options.httpResponseInfoLabel?{}:o),this.options.httpResponseInfoLabel&&(t[this.options.httpResponseInfoLabel]=o);var r=JSON.stringify(t);if(this.options.debug){var n=this.options.debug;"function"!=typeof n&&(n=this._defaultDebug),n(e,o,JSON.parse(r))}return[o.code,r,{"Content-Type":"application/json"}]},e.prototype._defaultDebug=function(t,e,o){var r=function(t,e){return Array(Math.max(e-(t+"").length+1,0)).join(0)+t},n=new Date,i=[r(n.getHours(),2),r(n.getMinutes(),2),r(n.getSeconds(),2),r(n.getMilliseconds(),3)];console.log([i.join(":"),">>> "+t.method+" "+t.rawUrl,"<<< "+e.code,o])},e.prototype.route=function(e,r,n){if(!o.test(r))throw'Invalid url for route: "'+r+'".';var i=this._baseUrl+r,s=i.replace(/\//g,"\\/").replace(/\?/g,"([\\w\\-]+)"),a=RegExp("^"+s+"(?:\\?.*)?$"),u=this;t.when(e,a).respond(function(t,e,o,r){var i=purl(e,!0),s=a.exec(i.attr("path")).slice(1),p=new u.HttpRequest(s,t,e,i,o,r),c=n.call(u,p);return u._buildResponse(c,p)})},e.prototype.setOptions=function(t){var e=this;return angular.forEach(t,function(t,o){if(e.DEFAULT_OPTIONS[o]===void 0)throw"Invalid option key "+o;e.options[o]=t}),e};var r=function(t,o){return new e(t,o)};return r.classFn=e,r}]),angular.module("restfulNgMock").factory("resourceMock",["basicMock",function(t){function e(t,o,r){e._super.constructor(t,r),this.dataSource=o||{},this.requiredParams=0;for(var n=0;t.length>n;++n)"?"===t.charAt(n)&&++this.requiredParams;this.route("GET","",function(t){var e=this.indexAction(t);return this._labelEncap(!0,e)}),this.route("GET","/?",function(t){var e=this.showAction(t);return this._labelEncap(!1,e)}),this.route("POST","",function(t){var e=this.createAction(t);return this._labelEncap(!1,e)}),this.route("PUT","/?",function(t){var e=this.updateAction(t);return this._labelEncap(!1,e)}),this.route("DELETE","/?",function(t){var e=this.deleteAction(t);return this._labelEncap(!1,e)})}(function(){function o(){this.constructor=e}var r=t.classFn;o.prototype=r.prototype,e.prototype=new o,e._super=r.prototype})(),e.prototype.parent=e.prototype,e.prototype.DEFAULT_OPTIONS=angular.extend({},e._super.DEFAULT_OPTIONS,{collectionLabel:!1,singletonLabel:!1,skipArgumentName:!1,limitArgumentName:!1}),e.prototype._labelEncap=function(t,e){if(e&&!(e instanceof this.HttpError)){var o=null;if(t&&this.options.collectionLabel?o=this.options.collectionLabel:!t&&this.options.singletonLabel&&(o=this.options.singletonLabel),o){var r=e;e={},e[o]=r}}return e},e.prototype.subResourceMock=function(t,o,r){return new e(this._baseUrl+"/?"+t,o,r)},e.prototype.getStorage=function(t,e){e=e||!1;for(var o=this.dataSource,r=0;t.length>r;++r)if(o[t[r]])o=o[t[r]];else{if(!e)return null;o[t[r]]={},o=o[t[r]]}return o||null},e.prototype.indexAction=function(t){var e=this.getStorage(t.pathArgs);if(e){var o=[];if(angular.forEach(e,function(t,e){/^\d+$/.test(e)&&(e=parseInt(e,10)),o.push(e)}),o.sort(),this.options.skipArgumentName){var r=parseInt(t.url.param(this.options.skipArgumentName),10);r&&(o=o.slice(r))}if(this.options.limitArgumentName){var n=parseInt(t.url.param(this.options.limitArgumentName),10);n&&(o=o.slice(0,n))}var i=[];return angular.forEach(o,function(t){i.push(e[t])}),i}},e.prototype.showAction=function(t){return this.getStorage(t.pathArgs)},e.prototype.createAction=function(t){var e=t.body;return e.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t.pathArgs,!0)[e.id]=e,e},e.prototype.updateAction=function(t){var e=t.body,o=this.getStorage(t.pathArgs.slice(0,-1)),r=t.pathArgs[t.pathArgs.length-1];return o&&o[r]?(e.id=o[r].id,o[r]=e,e):void 0},e.prototype.deleteAction=function(t){var e=this.getStorage(t.pathArgs.slice(0,-1)),o=t.pathArgs[t.pathArgs.length-1];if(e&&e[o]){var r=e[o];return delete e[o],r}};var o=function(t,o){return new e(t,o)};return o.classFn=e,o}])})(window);