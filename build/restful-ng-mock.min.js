(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("resourceMock",["$httpBackend",function(t){var e=function(t,e){this.code=t,this.message=e},n={collectionLabel:!1,singletonLabel:!1,httpResponseInfoLabel:!1,skipArgumentName:!1,limitArgumentName:!1,debug:!1},o=function(o,r,i){if(!/^\/[\w\-]+(\/[\w\-]+|\/\?)*$/.test(o))throw'Invalid baseUrl for resourceMock: "'+o+'".';this.baseUrl=o,this.dataSource=r||{},this.options=angular.extend({},n),this.setOptions(i||{});for(var a=0,s=0;o.length>s;++s)"?"===o.charAt(s)&&++a;var u=o.replace("/","\\/","g").replace("?","([\\w\\-]+)"),c=RegExp("^"+u+"(?:/([\\w\\-]+))?(?:\\?.*)?$"),l=this,p=function(t,e,n,o,r,i){var a=function(t,e){return Array(Math.max(e-(t+"").length+1,0)).join(0)+t},s=new Date,u=[a(s.getHours(),2),a(s.getMinutes(),2),a(s.getSeconds(),2),a(s.getMilliseconds(),3)];console.log([u.join(":"),">>> "+t+" "+e,"<<< "+r,i])},f=function(t){angular.isUndefined(t)&&(t=new e(404,"Not Found"));var n={code:200,message:"OK"};return t instanceof e&&(n.code=t.code,n.message=t.message,t=l.options.httpResponseInfoLabel?{}:n),l.options.httpResponseInfoLabel&&(t[l.options.httpResponseInfoLabel]=n),[n.code,JSON.stringify(t),{"Content-Type":"application/json"}]},g=function(t,n,o,r,i){for(var s=purl(n,!0),u=c.exec(s.attr("path")).slice(1),g=[],h=0;u.length>h;++h)"null"!=typeof u[h]&&u[h]!==void 0&&g.push(u[h]);var d,v=!1;if(i.atRoot&&g.length===a)v="GET"===t,d=i.atRoot.call(l,g,s,o,r);else if(i.atItem&&g.length>a){var m=g.slice(0,-1),w=g[g.length-1];d=i.atItem.call(l,m,w,s,o,r)}else d=new e(400,"Bad Request");if(d&&!(d instanceof e)){var A=null;if(v&&l.options.collectionLabel?A=l.options.collectionLabel:!v&&l.options.singletonLabel&&(A=l.options.singletonLabel),A){var b=d;d={},d[A]=b}}var R=f(d);if(l.options.debug){var I=l.options.debug;"function"!=typeof I&&(I=p),I(t,n,o,r,R[0],JSON.parse(R[1]))}return R};t.whenGET(RegExp(c)).respond(function(t,e,n,o){return g(t,e,n,o,{atRoot:l.indexAction,atItem:l.showAction})}),t.whenPOST(RegExp(c)).respond(function(t,e,n,o){return g(t,e,n,o,{atRoot:l.createAction})}),t.whenPUT(RegExp(c)).respond(function(t,e,n,o){return g(t,e,n,o,{atItem:l.updateAction})}),t.whenDELETE(RegExp(c)).respond(function(t,e,n,o){return g(t,e,n,o,{atItem:l.deleteAction})})};o.prototype={subResourceMock:function(t,e){return new o(this.baseUrl+"/?"+t,e)},getStorage:function(t,e){e=e||!1;for(var n=this.dataSource,o=0;t.length>o;++o)if(n[t[o]])n=n[t[o]];else{if(!e)return null;n[t[o]]={},n=n[t[o]]}return n||null},setOptions:function(t){var e=this;return angular.forEach(t,function(t,o){if(n[o]===void 0)throw"Invalid option key "+o;e.options[o]=t}),e},indexAction:function(t,e){var n=this.getStorage(t);if(n){var o=[];if(angular.forEach(n,function(t,e){/^\d+$/.test(e)&&(e=parseInt(e,10)),o.push(e)}),o.sort(),this.options.skipArgumentName){var r=parseInt(e.param(this.options.skipArgumentName),10);r&&(o=o.slice(r))}if(this.options.limitArgumentName){var i=parseInt(e.param(this.options.limitArgumentName),10);i&&(o=o.slice(0,i))}var a=[];return angular.forEach(o,function(t){a.push(n[t])}),a}},showAction:function(t,e){var n=this.getStorage(t);return n&&n[e]?n[e]:void 0},createAction:function(t,e,n){var o=JSON.parse(n);return o.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t,!0)[o.id]=o,o},updateAction:function(t,e,n,o){var r=this.getStorage(t);if(r&&r[e]){var i=JSON.parse(o);return i.id=r[e].id,r[e]=i,i}},deleteAction:function(t,e){var n=this.getStorage(t);if(n&&n[e]){var o=n[e];return delete n[e],o}}},o.prototype.parent=o.prototype;var r=function(t,e){return new o(t,e)};return r}])})(window);