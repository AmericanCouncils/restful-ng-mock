(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("basicMock",["$httpBackend",function(t){function o(t,o){if(this._baseUrl=t||"",!e.test(this._baseUrl))throw'Invalid baseUrl for resourceMock: "'+t+'".';this.options=angular.extend({},this.DEFAULT_OPTIONS),this.setOptions(o||{})}var e=/^(\/[\w\-]+|)(\/[\w\-]+|\/\?)*$/;o.prototype.constructor=o,o.prototype.HttpError=function(){function t(t,o){this.code=t,this.message=o}return t}(),o.prototype.HttpRequest=function(){function t(t,o,e,n,r,i){this.pathArgs=t,this.method=o,this.rawUrl=e,this.url=n,this.rawBody=r,this.body=/^application\/json($|;)/.test(i["Content-Type"])?JSON.parse(r):r,this.headers=i}return t}(),o.prototype.RouteOptions=function(){function t(){this.postProcs=[]}return t.prototype.addPostProc=function(t){this.postProcs.push(t)},t}(),o.prototype.DEFAULT_OPTIONS={debug:!1,httpResponseInfoLabel:!1},o.prototype._buildResponse=function(t,o){(angular.isUndefined(t)||null===t)&&(t=new this.HttpError(404,"Not Found"));var e={code:200,message:"OK"};t instanceof this.HttpError&&(e.code=t.code,e.message=t.message,t=this.options.httpResponseInfoLabel?{}:e),this.options.httpResponseInfoLabel&&(t[this.options.httpResponseInfoLabel]=e);var n=JSON.stringify(t);if(this.options.debug){var r=this.options.debug;"function"!=typeof r&&(r=this._defaultDebug),r(o,e,JSON.parse(n))}return[e.code,n,{"Content-Type":"application/json"}]},o.prototype._defaultDebug=function(t,o,e){var n=function(t,o){return Array(Math.max(o-(t+"").length+1,0)).join(0)+t},r=new Date,i=[n(r.getHours(),2),n(r.getMinutes(),2),n(r.getSeconds(),2),n(r.getMilliseconds(),3)];console.log([i.join(":"),">>> "+t.method+" "+t.rawUrl,"<<< "+o.code,e])},o.prototype.route=function(o,n,r){if(!e.test(n))throw'Invalid url for route: "'+n+'".';var i=this._baseUrl+n,s=i.replace(/\//g,"\\/").replace(/\?/g,"([\\w\\-]+)"),a=RegExp("^"+s+"(?:\\?.*)?$"),u=new this.RouteOptions,p=this;return t.when(o,a).respond(function(t,o,e,n){var i=purl(o,!0),s=a.exec(i.attr("path")).slice(1),c=new p.HttpRequest(s,t,o,i,e,n),l=r.call(p,c);return angular.forEach(u.postProcs,function(t){l=t.call(p,l,c)}),p._buildResponse(l,c)}),u},o.prototype.setOptions=function(t){var o=this;return angular.forEach(t,function(t,e){if(o.DEFAULT_OPTIONS[e]===void 0)throw"Invalid option key "+e;o.options[e]=t}),o};var n=function(t,e){return new o(t,e)};return n.classFn=o,n}]),angular.module("restfulNgMock").factory("resourceMock",["basicMock",function(t){function o(t,e,n){o._super.constructor.call(this,t,n),this.dataSource=e||{},this.requiredParams=0;for(var r=0;t.length>r;++r)"?"===t.charAt(r)&&++this.requiredParams;this._indexRoute=this.route("GET","",function(t){var o=this.indexAction(t);return this._labelEncap(!0,o)}),this._showRoute=this.route("GET","/?",function(t){var o=this.showAction(t);return this._labelEncap(!1,o)}),this._createRoute=this.route("POST","",function(t){var o=this.createAction(t);return this._labelEncap(!1,o)}),this._updateRoute=this.route("PUT","/?",function(t){var o=this.updateAction(t);return this._labelEncap(!1,o)}),this._deleteRoute=this.route("DELETE","/?",function(t){var o=this.deleteAction(t);return this._labelEncap(!1,o)})}(function(){function e(){this.constructor=o}var n=t.classFn;e.prototype=n.prototype,o.prototype=new e,o._super=n.prototype})(),o.prototype.parent=o.prototype,o.prototype.DEFAULT_OPTIONS=angular.extend({},o._super.DEFAULT_OPTIONS,{collectionLabel:!1,singletonLabel:!1,skipArgumentName:!1,limitArgumentName:!1}),o.prototype._labelEncap=function(t,o){if(o&&!(o instanceof this.HttpError)){var e=null;if(t&&this.options.collectionLabel?e=this.options.collectionLabel:!t&&this.options.singletonLabel&&(e=this.options.singletonLabel),e){var n=o;o={},o[e]=n}}return o},o.prototype.subResourceMock=function(t,e,n){return new o(this._baseUrl+"/?"+t,e,n)},o.prototype.addIndexFilter=function(t){this._indexRoute.addPostProc(function(o,e){if(e.url.param(t)){this.options.collectionLabel&&(o=o[this.options.collectionLabel]);var n,r=[];for(n in o)o[n][t]===e.url.param(t)&&r.push(o[n]);return r}})},o.prototype.getStorage=function(t,o){t=t||[],o=o||!1;for(var e=this.dataSource,n=0;t.length>n;++n)if(e[t[n]])e=e[t[n]];else{if(!o)return null;e[t[n]]={},e=e[t[n]]}return e||null},o.prototype.indexAction=function(t){var o=this.getStorage(t.pathArgs);if(o){var e=[];if(angular.forEach(o,function(t,o){/^\d+$/.test(o)&&(o=parseInt(o,10)),e.push(o)}),e.sort(),this.options.skipArgumentName){var n=parseInt(t.url.param(this.options.skipArgumentName),10);n&&(e=e.slice(n))}if(this.options.limitArgumentName){var r=parseInt(t.url.param(this.options.limitArgumentName),10);r&&(e=e.slice(0,r))}var i=[];return angular.forEach(e,function(t){i.push(o[t])}),i}},o.prototype.showAction=function(t){return this.getStorage(t.pathArgs)},o.prototype.createAction=function(t){var o=t.body;return o.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t.pathArgs,!0)[o.id]=o,o},o.prototype.updateAction=function(t){var o=t.body,e=this.getStorage(t.pathArgs.slice(0,-1)),n=t.pathArgs[t.pathArgs.length-1];return e&&e[n]?(o.id=e[n].id,e[n]=o,o):void 0},o.prototype.deleteAction=function(t){var o=this.getStorage(t.pathArgs.slice(0,-1)),e=t.pathArgs[t.pathArgs.length-1];if(o&&o[e]){var n=o[e];return delete o[e],n}};var e=function(t,e){return new o(t,e)};return e.classFn=o,e}])})(window);