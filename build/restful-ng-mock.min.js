(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("basicMock",["$httpBackend",function(t){function r(t,r){if(this._baseUrl=t||"",!o.test(this._baseUrl))throw'Invalid baseUrl for resourceMock: "'+t+'".';this.options=angular.extend({},this.DEFAULT_OPTIONS),this.setOptions(r||{})}var o=/^((http(s)?:\/)?\/[\w\-\.]+|)(\/[\w\-]+|\/\?)*$/;r.prototype.constructor=r,r.prototype.HttpError=function(){function t(t,r){this.code=t,this.message=r}return t}(),r.prototype.HttpRequest=function(){function t(t,r,o,e,n,i){this.pathArgs=t,this.method=r,this.rawUrl=o,this.url=e,this.rawBody=n,this.body=/^application\/json($|;)/.test(i["Content-Type"])?JSON.parse(n):n,this.headers=i}return t}(),r.prototype.RouteOptions=function(){function t(){this.postProcs=[]}return t.prototype.addPostProc=function(t){return this.postProcs.push(t),this},t}(),r.prototype.DEFAULT_OPTIONS={debug:!1,httpResponseInfoLabel:!1},r.prototype._buildResponse=function(t,r){(angular.isUndefined(t)||null===t)&&(t=new this.HttpError(404,"Not Found"));var o={code:200,message:"OK"};t instanceof this.HttpError&&(o.code=t.code,o.message=t.message,t=this.options.httpResponseInfoLabel?{}:o),angular.isObject(t)&&!angular.isArray(t)&&this.options.httpResponseInfoLabel&&(t[this.options.httpResponseInfoLabel]=o);var e=JSON.stringify(t);if(this.options.debug){var n=this.options.debug;"function"!=typeof n&&(n=this._defaultDebug),n(r,o,JSON.parse(e))}return[o.code,e,{"Content-Type":"application/json"}]},r.prototype._defaultDebug=function(t,r,o){var e=function(t,r){return Array(Math.max(r-(t+"").length+1,0)).join(0)+t},n=new Date,i=[e(n.getHours(),2),e(n.getMinutes(),2),e(n.getSeconds(),2),e(n.getMilliseconds(),3)];console.log([i.join(":"),">>> "+t.method+" "+t.rawUrl,"<<< "+r.code,o])},r.prototype.route=function(e,n,i){if(!o.test(n))throw'Invalid url for route: "'+n+'".';var s=this._baseUrl+n,a=s.replace(/\//g,"\\/").replace(/\?/g,"([\\w\\-]+)"),u=purl(s,!0).attr("base").replace(/\//g,"\\/").replace(/\?/g,"([\\w\\-]+)");a=a.replace(u,"(?:"+u+")?");var p=RegExp("^"+a+"(?:\\?.*)?$"),c=new this.RouteOptions,h=this;return t.when(e,p).respond(function(t,o,e,n){var s=purl(o,!0),a=p.exec(s.attr("path")).slice(1),u=new h.HttpRequest(a,t,o,s,e,n),l=i.call(h,u);return angular.forEach(c.postProcs,function(t){!l||l instanceof r.prototype.HttpError||(l=t.call(h,l,u))}),h._buildResponse(l,u)}),c},r.prototype.setOptions=function(t){var r=this;return angular.forEach(t,function(t,o){if(r.DEFAULT_OPTIONS[o]===void 0)throw"Invalid option key "+o;r.options[o]=t}),r};var e=function(t,o){return new r(t,o)};return e.classFn=r,e}]),angular.module("restfulNgMock").factory("resourceMock",["basicMock",function(t){function r(t,o,e){r._super.constructor.call(this,t,e),this.dataSource=o||{},this.requiredParams=0;for(var n=0;t.length>n;++n)"?"===t.charAt(n)&&++this.requiredParams;this.indexRoute=this.route("GET","",function(t){return this.indexAction(t)}),this.showRoute=this.route("GET","/?",function(t){return this.showAction(t)}),this.createRoute=this.route("POST","",function(t){return this.createAction(t)}),this.updateRoute=this.route("PUT","/?",function(t){return this.updateAction(t)}),this.deleteRoute=this.route("DELETE","/?",function(t){return this.deleteAction(t)})}(function(){function o(){this.constructor=r}var e=t.classFn;o.prototype=e.prototype,r.prototype=new o,r._super=e.prototype})(),r.prototype.parent=r.prototype,r.prototype.subResourceMock=function(t,o,e){return new r(this._baseUrl+"/?"+t,o,e)},r.prototype.addIndexFilter=function(t,r){return r=r||function(r,o){return""+o[t]==""+r},this.indexRoute.addPostProc(function(o,e){if(e.url.param(t)){var n,i=[];for(n in o)r(e.url.param(t),o[n])&&i.push(o[n]);return i}}),this},r.prototype.addIndexArrayFilter=function(t,r,o){return r=r||",",o=o||function(r,o){return""+o[t]==""+r},this.indexRoute.addPostProc(function(e,n){if(n.url.param(t)){var i,s,a=[],u=n.url.param(t).split(r);for(i in e)for(s in u)if(o(u[s],e[i])){a.push(e[i]);break}return a}}),this},r.prototype.addIndexPagination=function(t,r){t=t||"skip",r=r||"limit",this.indexRoute.addPostProc(function(o,e){var n=parseInt(e.url.param(t),10);n&&(o=o.slice(n));var i=parseInt(e.url.param(r),10);return i&&(o=o.slice(0,i)),o})},r.prototype.addSingletonPostProcs=function(t){var r=[this.showRoute,this.createRoute,this.updateRoute,this.deleteRoute];angular.forEach(r,function(r){r.addPostProc(t)})},r.prototype.addLabeller=function(t,r){return t&&this.addSingletonPostProcs(function(r){var o={};return o[t]=r,o}),r&&this.indexRoute.addPostProc(function(t){var o={};return o[r]=t,o}),this},r.prototype.getStorage=function(t,r){t=t||[],r=r||!1;for(var o=this.dataSource,e=0;t.length>e;++e)if(o[t[e]])o=o[t[e]];else{if(!r)return null;o[t[e]]={},o=o[t[e]]}return o||null},r.prototype.indexAction=function(t){var r=this.getStorage(t.pathArgs);if(r){var o=[];angular.forEach(r,function(t,r){/^\d+$/.test(r)&&(r=parseInt(r,10)),o.push(r)}),o.sort();var e=[];return angular.forEach(o,function(t){e.push(r[t])}),e}},r.prototype.showAction=function(t){return this.getStorage(t.pathArgs)},r.prototype.createAction=function(t){var r=t.body;return r.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t.pathArgs,!0)[r.id]=r,r},r.prototype.updateAction=function(t){var r=t.body,o=this.getStorage(t.pathArgs.slice(0,-1)),e=t.pathArgs[t.pathArgs.length-1];return o&&o[e]?(r.id=o[e].id,o[e]=r,r):void 0},r.prototype.deleteAction=function(t){var r=this.getStorage(t.pathArgs.slice(0,-1)),o=t.pathArgs[t.pathArgs.length-1];if(r&&r[o]){var e=r[o];return delete r[o],e}};var o=function(t,o,e){return new r(t,o,e)};return o.classFn=r,o}])})(window);