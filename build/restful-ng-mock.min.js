(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("basicMock",["$httpBackend",function(t){var e=function(t,e){this.code=t,this.message=e},n={debug:!1},o=function(t,e){if(!/^\/[\w\-]+(\/[\w\-]+|\/\?)*$/.test(t))throw'Invalid baseUrl for resourceMock: "'+t+'".';this.baseUrl=t,this.options=angular.extend({},n),this.setOptions(e||{})};o.prototype={_buildResponse:function(t){angular.isUndefined(t)&&(t=new e(404,"Not Found"));var n={code:200,message:"OK"};return t instanceof e&&(n.code=t.code,n.message=t.message,t=this.options.httpResponseInfoLabel?{}:n),this.options.httpResponseInfoLabel&&(t[this.options.httpResponseInfoLabel]=n),[n.code,JSON.stringify(t),{"Content-Type":"application/json"}]},route:function(e,n,o){var i=this.baseUrl+n,r=i.replace("/","\\/","g").replace("?","([\\w\\-]+)"),a=RegExp("^"+r+"(?:/([\\w\\-]+))?(?:\\?.*)?$"),s=this;t.when(e,a).respond(function(t,e,n,i){var r=purl(e,!0),u=a.exec(r.attr("path")).slice(1),c=o(u,t,r,n,i);return s._buildResponse(c)})},setOptions:function(t){var e=this;return angular.forEach(t,function(t,o){if(n[o]===void 0)throw"Invalid option key "+o;e.options[o]=t}),e}};var i=function(t,e){return new o(t,e)};return i}]),angular.module("restfulNgMock").factory("resourceMock",["$httpBackend",function(t){var e=function(t,e){this.code=t,this.message=e},n={collectionLabel:!1,singletonLabel:!1,httpResponseInfoLabel:!1,skipArgumentName:!1,limitArgumentName:!1,debug:!1},o=function(o,i,r){this.baseUrl=o,this.dataSource=i||{},this.options=angular.extend({},n),this.setOptions(r||{});for(var a=0,s=0;o.length>s;++s)"?"===o.charAt(s)&&++a;var u=o.replace("/","\\/","g").replace("?","([\\w\\-]+)"),c=RegExp("^"+u+"(?:/([\\w\\-]+))?(?:\\?.*)?$"),p=this,l=function(t,e,n,o,i,r){var a=function(t,e){return Array(Math.max(e-(t+"").length+1,0)).join(0)+t},s=new Date,u=[a(s.getHours(),2),a(s.getMinutes(),2),a(s.getSeconds(),2),a(s.getMilliseconds(),3)];console.log([u.join(":"),">>> "+t+" "+e,"<<< "+i,r])},f=function(t){angular.isUndefined(t)&&(t=new e(404,"Not Found"));var n={code:200,message:"OK"};return t instanceof e&&(n.code=t.code,n.message=t.message,t=p.options.httpResponseInfoLabel?{}:n),p.options.httpResponseInfoLabel&&(t[p.options.httpResponseInfoLabel]=n),[n.code,JSON.stringify(t),{"Content-Type":"application/json"}]},h=function(t,n,o,i,r){for(var s=purl(n,!0),u=c.exec(s.attr("path")).slice(1),h=[],g=0;u.length>g;++g)"null"!=typeof u[g]&&u[g]!==void 0&&h.push(u[g]);var d,v=!1;if(r.atRoot&&h.length===a)v="GET"===t,d=r.atRoot.call(p,h,s,o,i);else if(r.atItem&&h.length>a){var m=h.slice(0,-1),b=h[h.length-1];d=r.atItem.call(p,m,b,s,o,i)}else d=new e(400,"Bad Request");if(d&&!(d instanceof e)){var w=null;if(v&&p.options.collectionLabel?w=p.options.collectionLabel:!v&&p.options.singletonLabel&&(w=p.options.singletonLabel),w){var R=d;d={},d[w]=R}}var A=f(d);if(p.options.debug){var I=p.options.debug;"function"!=typeof I&&(I=l),I(t,n,o,i,A[0],JSON.parse(A[1]))}return A};t.whenGET(RegExp(c)).respond(function(t,e,n,o){return h(t,e,n,o,{atRoot:p.indexAction,atItem:p.showAction})}),t.whenPOST(RegExp(c)).respond(function(t,e,n,o){return h(t,e,n,o,{atRoot:p.createAction})}),t.whenPUT(RegExp(c)).respond(function(t,e,n,o){return h(t,e,n,o,{atItem:p.updateAction})}),t.whenDELETE(RegExp(c)).respond(function(t,e,n,o){return h(t,e,n,o,{atItem:p.deleteAction})})};o.prototype={subResourceMock:function(t,e){return new o(this.baseUrl+"/?"+t,e)},getStorage:function(t,e){e=e||!1;for(var n=this.dataSource,o=0;t.length>o;++o)if(n[t[o]])n=n[t[o]];else{if(!e)return null;n[t[o]]={},n=n[t[o]]}return n||null},setOptions:function(t){var e=this;return angular.forEach(t,function(t,o){if(n[o]===void 0)throw"Invalid option key "+o;e.options[o]=t}),e},indexAction:function(t,e){var n=this.getStorage(t);if(n){var o=[];if(angular.forEach(n,function(t,e){/^\d+$/.test(e)&&(e=parseInt(e,10)),o.push(e)}),o.sort(),this.options.skipArgumentName){var i=parseInt(e.param(this.options.skipArgumentName),10);i&&(o=o.slice(i))}if(this.options.limitArgumentName){var r=parseInt(e.param(this.options.limitArgumentName),10);r&&(o=o.slice(0,r))}var a=[];return angular.forEach(o,function(t){a.push(n[t])}),a}},showAction:function(t,e){var n=this.getStorage(t);return n&&n[e]?n[e]:void 0},createAction:function(t,e,n){var o=JSON.parse(n);return o.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t,!0)[o.id]=o,o},updateAction:function(t,e,n,o){var i=this.getStorage(t);if(i&&i[e]){var r=JSON.parse(o);return r.id=i[e].id,i[e]=r,r}},deleteAction:function(t,e){var n=this.getStorage(t);if(n&&n[e]){var o=n[e];return delete n[e],o}}},o.prototype.parent=o.prototype;var i=function(t,e){return new o(t,e)};return i}])})(window);