(function(){"use strict";angular.module("restfulNgMock",[]),angular.module("restfulNgMock").factory("basicMock",["$httpBackend",function(t){function o(t,o){if(this._baseUrl=t||"",!e.test(this._baseUrl))throw'Invalid baseUrl for resourceMock: "'+t+'".';this.options=angular.extend({},this.DEFAULT_OPTIONS),this.setOptions(o||{})}var e=/^(\/[\w\-]+|)(\/[\w\-]+|\/\?)*$/;o.prototype.constructor=o,o.prototype.HttpError=function(){function t(t,o){this.code=t,this.message=o}return t}(),o.prototype.HttpRequest=function(){function t(t,o,e,r,n,i){this.pathArgs=t,this.method=o,this.rawUrl=e,this.url=r,this.rawBody=n,this.body=/^application\/json($|;)/.test(i["Content-Type"])?JSON.parse(n):n,this.headers=i}return t}(),o.prototype.RouteOptions=function(){function t(){this.postProcs=[]}return t.prototype.addPostProc=function(t){return this.postProcs.push(t),this},t}(),o.prototype.DEFAULT_OPTIONS={debug:!1,httpResponseInfoLabel:!1},o.prototype._buildResponse=function(t,o){(angular.isUndefined(t)||null===t)&&(t=new this.HttpError(404,"Not Found"));var e={code:200,message:"OK"};t instanceof this.HttpError&&(e.code=t.code,e.message=t.message,t=this.options.httpResponseInfoLabel?{}:e),this.options.httpResponseInfoLabel&&(t[this.options.httpResponseInfoLabel]=e);var r=JSON.stringify(t);if(this.options.debug){var n=this.options.debug;"function"!=typeof n&&(n=this._defaultDebug),n(o,e,JSON.parse(r))}return[e.code,r,{"Content-Type":"application/json"}]},o.prototype._defaultDebug=function(t,o,e){var r=function(t,o){return Array(Math.max(o-(t+"").length+1,0)).join(0)+t},n=new Date,i=[r(n.getHours(),2),r(n.getMinutes(),2),r(n.getSeconds(),2),r(n.getMilliseconds(),3)];console.log([i.join(":"),">>> "+t.method+" "+t.rawUrl,"<<< "+o.code,e])},o.prototype.route=function(r,n,i){if(!e.test(n))throw'Invalid url for route: "'+n+'".';var s=this._baseUrl+n,u=s.replace(/\//g,"\\/").replace(/\?/g,"([\\w\\-]+)"),a=RegExp("^"+u+"(?:\\?.*)?$"),p=new this.RouteOptions,c=this;return t.when(r,a).respond(function(t,e,r,n){var s=purl(e,!0),u=a.exec(s.attr("path")).slice(1),h=new c.HttpRequest(u,t,e,s,r,n),l=i.call(c,h);return angular.forEach(p.postProcs,function(t){!l||l instanceof o.prototype.HttpError||(l=t.call(c,l,h))}),c._buildResponse(l,h)}),p},o.prototype.setOptions=function(t){var o=this;return angular.forEach(t,function(t,e){if(o.DEFAULT_OPTIONS[e]===void 0)throw"Invalid option key "+e;o.options[e]=t}),o};var r=function(t,e){return new o(t,e)};return r.classFn=o,r}]),angular.module("restfulNgMock").factory("resourceMock",["basicMock",function(t){function o(t,e,r){o._super.constructor.call(this,t,r),this.dataSource=e||{},this.requiredParams=0;for(var n=0;t.length>n;++n)"?"===t.charAt(n)&&++this.requiredParams;this.indexRoute=this.route("GET","",function(t){return this.indexAction(t)}),this.showRoute=this.route("GET","/?",function(t){return this.showAction(t)}),this.createRoute=this.route("POST","",function(t){return this.createAction(t)}),this.updateRoute=this.route("PUT","/?",function(t){return this.updateAction(t)}),this.deleteRoute=this.route("DELETE","/?",function(t){return this.deleteAction(t)}),this.singletonRoutes=[this.showRoute,this.createRoute,this.updateRoute,this.deleteRoute]}(function(){function e(){this.constructor=o}var r=t.classFn;e.prototype=r.prototype,o.prototype=new e,o._super=r.prototype})(),o.prototype.parent=o.prototype,o.prototype.subResourceMock=function(t,e,r){return new o(this._baseUrl+"/?"+t,e,r)},o.prototype.addIndexFilter=function(t){return this.indexRoute.addPostProc(function(o,e){if(e.url.param(t)){var r,n=[];for(r in o)o[r][t]===e.url.param(t)&&n.push(o[r]);return n}}),this},o.prototype.addIndexPagination=function(t,o){t=t||"skip",o=o||"limit",this.indexRoute.addPostProc(function(e,r){var n=parseInt(r.url.param(t),10);n&&(e=e.slice(n));var i=parseInt(r.url.param(o),10);return i&&(e=e.slice(0,i)),e})},o.prototype.addLabeller=function(t,o){return t&&angular.forEach(this.singletonRoutes,function(o){o.addPostProc(function(o){var e={};return e[t]=o,e})}),o&&this.indexRoute.addPostProc(function(t){var e={};return e[o]=t,e}),this},o.prototype.getStorage=function(t,o){t=t||[],o=o||!1;for(var e=this.dataSource,r=0;t.length>r;++r)if(e[t[r]])e=e[t[r]];else{if(!o)return null;e[t[r]]={},e=e[t[r]]}return e||null},o.prototype.indexAction=function(t){var o=this.getStorage(t.pathArgs);if(o){var e=[];angular.forEach(o,function(t,o){/^\d+$/.test(o)&&(o=parseInt(o,10)),e.push(o)}),e.sort();var r=[];return angular.forEach(e,function(t){r.push(o[t])}),r}},o.prototype.showAction=function(t){return this.getStorage(t.pathArgs)},o.prototype.createAction=function(t){var o=t.body;return o.id=Math.round(Math.random()*Math.pow(2,32)),this.getStorage(t.pathArgs,!0)[o.id]=o,o},o.prototype.updateAction=function(t){var o=t.body,e=this.getStorage(t.pathArgs.slice(0,-1)),r=t.pathArgs[t.pathArgs.length-1];return e&&e[r]?(o.id=e[r].id,e[r]=o,o):void 0},o.prototype.deleteAction=function(t){var o=this.getStorage(t.pathArgs.slice(0,-1)),e=t.pathArgs[t.pathArgs.length-1];if(o&&o[e]){var r=o[e];return delete o[e],r}};var e=function(t,e){return new o(t,e)};return e.classFn=o,e}])})(window);